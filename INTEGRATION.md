# Интеграция Frontend и Backend

## Что было сделано

### 1. API Client (`src/composables/useApi.js`)
- Создан централизованный API клиент для работы с backend
- Реализована аутентификация с JWT токенами
- Автоматическое обновление токенов при истечении
- Методы для всех API endpoints:
  - Аутентификация (регистрация, вход, выход)
  - Игровые сессии (сохранение, загрузка)
  - Таблица лидеров
  - Достижения
  - Система друзей

### 2. Компоненты

#### AuthModal (`src/components/AuthModal.vue`)
- Модальное окно для регистрации и входа
- Валидация форм
- Обработка ошибок

#### Achievements (`src/components/Achievements.vue`)
- Отображение всех достижений
- Показ разблокированных достижений
- Загрузка данных с сервера

#### Friends (`src/components/Friends.vue`)
- Список друзей
- Запросы на дружбу
- Принятие/отклонение запросов

### 3. Обновленные компоненты

#### GameHeader
- Отображение имени пользователя
- Кнопки входа/выхода
- Статус аутентификации

#### HighScores
- Отображение глобальной таблицы лидеров с сервера
- Сохранение локальных рекордов
- Загрузка данных с backend

#### Settings
- Отображение информации о профиле пользователя

#### App.vue
- Интеграция всех API методов
- Автоматическое сохранение игровых сессий
- Загрузка данных при монтировании
- Обновление лидерборда после игры

## Настройка

### 1. Переменные окружения

Создайте файл `.env` в корне проекта (рядом с `package.json`):

```env
VITE_API_BASE_URL=http://localhost:8000/api
```

Для продакшена измените на URL вашего backend сервера.

### 2. Запуск Backend

```bash
cd backend
docker-compose up
```

Или локально:
```bash
cd backend
python manage.py runserver
```

### 3. Запуск Frontend

```bash
npm run dev
```

## Использование

### Регистрация/Вход
1. Нажмите кнопку "Войти" в шапке
2. Зарегистрируйтесь или войдите
3. После успешной аутентификации токены сохраняются в localStorage

### Сохранение игры
- Игровые сессии автоматически сохраняются при завершении игры
- Данные отправляются на backend если пользователь авторизован
- Локальные рекорды сохраняются в localStorage для всех пользователей

### Таблица лидеров
- Глобальная таблица загружается с сервера
- Локальные рекорды отображаются отдельно
- Обновляется после каждой игры

### Достижения
- Отображаются только для авторизованных пользователей
- Автоматически разблокируются при выполнении условий
- Загружаются с сервера

### Друзья
- Доступна только для авторизованных пользователей
- Можно отправлять запросы на дружбу
- Принимать/отклонять запросы

## API Endpoints

Все endpoints доступны через `useApi` composable:

```javascript
import { useAuth, useGameSessions, useLeaderboard, useAchievements, useFriends } from './composables/useApi'

// Аутентификация
const { register, login, logout, fetchUserProfile } = useAuth()

// Игровые сессии
const { saveGameSession, loadLatestSession } = useGameSessions()

// Таблица лидеров
const { getLeaderboard } = useLeaderboard()

// Достижения
const { getAchievements, getUserAchievements } = useAchievements()

// Друзья
const { getFriends, sendFriendRequest, acceptFriendRequest } = useFriends()
```

## Безопасность

- JWT токены хранятся в localStorage
- Токены автоматически обновляются при истечении
- Все запросы включают Authorization header
- CORS настроен на backend для работы с frontend

## Отладка

Если возникают проблемы:

1. Проверьте, что backend запущен и доступен
2. Проверьте переменную `VITE_API_BASE_URL` в `.env`
3. Откройте консоль браузера для просмотра ошибок
4. Проверьте Network tab в DevTools для просмотра запросов

