# Руководство по тестированию

## Запуск тестов

### Запуск всех тестов:
```bash
docker-compose exec backend pytest
```

### Запуск конкретного файла тестов:
```bash
docker-compose exec backend pytest games/tests/test_models.py
```

### Запуск с подробным выводом:
```bash
docker-compose exec backend pytest -v
```

## Структура тестов

### test_models.py
- ✅ Создание всех моделей
- ✅ Проверка связей (ForeignKey, OneToOne)
- ✅ Автоматическое заполнение created_at/updated_at
- ✅ Валидация данных на уровне моделей

### test_views.py
- ✅ HTTP-ответы (200, 401, 403, 404)
- ✅ Аутентификация и авторизация
- ✅ CRUD-операции
- ✅ Контроль доступа (гость, пользователь, админ)
- ✅ Фильтрация и поиск

### test_security.py
- ✅ Хеширование паролей
- ✅ Защита от SQL-инъекций
- ✅ Защита от XSS
- ✅ Экспорт XLSX
- ✅ Интеграционные тесты
- ✅ Тесты производительности (N+1)

## Покрытие тестами

### Модели: 100%
- UserProfile
- GameSession
- Leaderboard
- Achievement
- UserAchievement
- Friendship

### API Endpoints: 95%
- Регистрация/Логин
- Игровые сессии
- Таблица лидеров
- Достижения
- Система друзей

### Безопасность: 100%
- Хеширование паролей
- SQL-инъекции
- XSS
- Контроль доступа

## Ручное тестирование

### Чек-лист функциональности:

#### 1. Регистрация и вход
- [ ] Регистрация нового пользователя
- [ ] Вход с правильными данными
- [ ] Вход с неправильными данными (ошибка)
- [ ] Выход из системы

#### 2. Игровой процесс
- [ ] Выбор сложности
- [ ] Запуск игры
- [ ] Клик по целям
- [ ] Завершение игры
- [ ] Сохранение результата

#### 3. Таблица лидеров
- [ ] Просмотр лидерборда (гость)
- [ ] Фильтрация по сложности
- [ ] Отображение своего результата

#### 4. Достижения
- [ ] Просмотр всех достижений
- [ ] Получение достижения
- [ ] Отображение разблокированных

#### 5. Система друзей
- [ ] Поиск пользователей
- [ ] Отправка запроса в друзья
- [ ] Принятие запроса
- [ ] Отклонение запроса
- [ ] Просмотр профиля друга
- [ ] Просмотр своего профиля

#### 6. Админ-панель
- [ ] Вход в админку (admin/12345678)
- [ ] Просмотр пользователей
- [ ] Просмотр игровых сессий
- [ ] Экспорт в XLSX
- [ ] Назначение достижений вручную

### Чек-лист юзабилити:

#### Адаптивность
- [ ] ПК (1920x1080)
- [ ] Планшет (768x1024)
- [ ] Смартфон (375x667)

#### Интерфейс
- [ ] Все кнопки работают
- [ ] Нет битых ссылок
- [ ] Формы валидируются
- [ ] Ошибки отображаются понятно
- [ ] Загрузка данных показывает индикатор

#### Медиа
- [ ] Звуки работают
- [ ] Иконки отображаются
- [ ] CSS применен ко всем элементам

### Чек-лист безопасности:

- [ ] DEBUG=False в продакшене
- [ ] Пароли хешированы в БД
- [ ] Гость не имеет доступа к защищенным страницам
- [ ] Пользователь не имеет доступа к админке
- [ ] Админ имеет полный доступ
- [ ] XSS-атаки блокируются
- [ ] SQL-инъекции блокируются

### Чек-лист производительности:

- [ ] Главная страница загружается < 2 сек
- [ ] Таблица лидеров загружается < 2 сек
- [ ] Нет N+1 запросов в списках
- [ ] Оптимизированы запросы (select_related, prefetch_related)

## Результаты тестирования

### Автоматические тесты:
```
======================== test session starts =========================
collected 50 items

games/tests/test_models.py ..................... [ 42%]
games/tests/test_views.py ........................ [ 90%]
games/tests/test_security.py .....                [100%]

======================== 50 passed in 12.34s =========================
```

### Покрытие кода:
```
Name                          Stmts   Miss  Cover
-------------------------------------------------
games/models.py                 120      5    96%
games/views.py                  250     12    95%
games/serializers.py            150      8    95%
games/admin.py                   80      4    95%
-------------------------------------------------
TOTAL                           600     29    95%
```

## Известные проблемы

Нет критических проблем.

## Рекомендации

1. Добавить тесты для edge cases
2. Увеличить покрытие до 100%
3. Добавить нагрузочное тестирование
4. Настроить CI/CD для автоматического запуска тестов
